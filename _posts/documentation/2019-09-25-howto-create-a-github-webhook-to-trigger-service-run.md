---
layout: post
title: Howto create a github webhook to trigger service run 
category: documentation
---

We describe a way to rebuild devel packages in obs on each merge of a Pull 
Request.

## Preamble

For the following example we use the following data:

<b>Github Project:</b> https://github.com/M0ses/obs-testpackage

<b>OBS Project Name:</b> home:M0ses:test

<b>OBS Package Name:</b> obs-testpackage



The following data is autogenerated by OBS and shown
by the "osc token" commands:

<b>OBS Token ID:</b>     666

<b>OBS Token:</b>        XXXXXXXXXXXXXXXXXXXXXXXX

## Create a source service in OBS for your project/package

```
# osc co home:M0ses:test/obs-testpackage
# cd home:M0ses:test/obs-testpackage
```
create a file named ```_service``` with the following content


```
<services>
  <service name="obs_scm">
    <param name="url">https://github.com/M0ses/obs-testpackage</param>
    <param name="scm">git</param>
    <param name="versionformat">@PARENT_TAG@</param>
    <param name="extract">dist/obs-testpackage.spec</param>
  </service>
  <service name="set_version" mode="buildtime"/>
  <service name="tar" mode="buildtime"/>
  <service name="recompress" mode="buildtime">
    <param name="compression">gz</param>
    <param name="file">*.tar</param>
  </service>
</services>
```
then run the following commands:

```
# osc add _service
# osc ci -m "initial version of service file"
```

After this OBS will run the services automatically and build your packages.

<b>ATTENTION:</b>

Please be aware of the param "extract" which contains the path to the specfile
in your repository. It's also possible to commit this spec file to your OBS
project/package and then to remove it from the ```_service``` file.



<b></b>

## Create a token in OBS for your project/package

The following command creates a token for the "runservice" action,
which is the default action.


``` 
# osc token --create home:M0ses:test obs-testpackage
<status code="ok">
  <summary>Ok</summary>
  <data name="token">XXXXXXXXXXXXXXXXXXXXXXXX</data>
  <data name="id">666</data>
</status>
```


You can also list your existing tokens:


```

# osc token
<directory count="8">
  ...
  <entry id="666" string="XXXXXXXXXXXXXXXXXXXXXXXX" kind="runservice" project="home:M0ses:test" package="obs-testpackage"/>
</directory>

```

## Create a github webhook

Under the url

```
https://github.com/<project>/<repository>/settings/hooks
```
you should be able to create a webhook.

Enter the following "Payload URL" (use the id `osc token ...`)

```
https://build.opensuse.org/trigger/webhook?id=666
```

and as "Secret" use the token generate by osc

<img src="/images/posts/github-create-webhook.png" style="margin: 10px;" alt="Create Webhook on Github">

CONGRATULATIONS YOU ARE DONE !!!

Now on each push or merge of an Pull Request github sends a trigger to OBS and your packages gets rebuild.
